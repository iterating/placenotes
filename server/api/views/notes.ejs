<%- include('header.ejs') %>

<div class="logout">
  <form action="/users/logout" method="get" class="logout-button">
    <button type="submit">Log Out</button>
  </form>
</div>

<div id="notes" style="margin-top: 1em">
  <h1>Your Notes</h1>
  <div class="note-container">
    <ul class="notes-list">
      <% if (notes.length > 0) { %> <% notes.forEach(note => { %> <% if
      (note.userId && user && user._id && note.userId.toString() ===
      user._id.toString()) { %>
      <li>
        <p class="note-body"><%= note.body %></p>
        <form
          action="/notes/<%= note._id %>"
          method="POST"
          onsubmit="event.preventDefault(); deleteNote('<%= note._id %>');"
          class="button"
        >
          <button type="submit">Delete</button>
        </form>
        <script>
          async function deleteNote(noteId) {
            try {
              const response = await fetch(`/notes/${noteId}`, {
                method: "DELETE",
              });
              if (response.ok) {
                location.reload();
              } else {
                console.error("Failed to delete note");
              }
            } catch (error) {
              console.error("Error:", error);
            }
          }
        </script>
        <form action="/notes/<%= note._id %>/edit" method="GET" class="button">
          <button type="submit">Edit</button>
        </form>
      </li>
      <% } %> <% }); %> <% } else { %>
      <p>You don't have any notes yet.</p>
      <% } %>
    </ul>
    <p><a href="/notes/new">Create a new note</a></p>
  </div>
</div>
<%- include('footer.ejs') %>
