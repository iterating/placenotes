<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes</title>
</head>
<body>
    <form action="/users/logout" method="post">
        <button type="submit">Log Out</button>
    </form>
    <h1>Your Notes</h1>
    <ul>
        <% if (notes.length > 0) { %>
            <% notes.forEach(note => { %>
                <% if (note.userId && user && user._id && note.userId.toString() === user._id.toString()) { %>
                    <li>
                        <p><%= note.body %></p>
                        <form action="/notes/<%= note._id %>" method="POST" onsubmit="event.preventDefault(); deleteNote('<%= note._id %>');">
                            <button type="submit">Delete</button>
                        </form>
                        <script>
                            async function deleteNote(noteId) {
                                try {
                                    const response = await fetch(`/notes/${noteId}`, {
                                        method: 'DELETE',
                                    });
                                    if (response.ok) {
                                        location.reload();
                                    } else {
                                        console.error('Failed to delete note');
                                    }
                                } catch (error) {
                                    console.error('Error:', error);
                                }
                            }
                        </script>
                        <form action="/notes/<%= note._id %>/edit" method="GET">
                            <button type="submit">Edit</button>
                        </form>

                    </li>
                <% } %>
            <% }); %>
        <% } else { %>
            <p>You don't have any notes yet.</p>
        <% } %>
    </ul>
    <p><a href="/notes/new">Create a new note</a></p>
    
    
</body>
</html>

